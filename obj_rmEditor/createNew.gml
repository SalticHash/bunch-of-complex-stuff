/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_modRoom_init

System.Exception: Unable to find the var name for anonymous code object gml_Script_modRoom_init
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_instanceManager_reset

System.Exception: Unable to find the var name for anonymous code object gml_Script_instanceManager_reset
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_mod_folder_afom

System.Exception: Unable to find the var name for anonymous code object gml_Script_mod_folder_afom
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_find_files_recursive

System.Exception: Unable to find the var name for anonymous code object gml_Script_find_files_recursive
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_mod_folder_afom

System.Exception: Unable to find the var name for anonymous code object gml_Script_mod_folder_afom
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_array_value_exists

System.Exception: Unable to find the var name for anonymous code object gml_Script_array_value_exists
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_layerConfirm

System.Exception: Unable to find the var name for anonymous code object gml_Script_layerConfirm
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_layerFormat

System.Exception: Unable to find the var name for anonymous code object gml_Script_layerFormat
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_layerFormat

System.Exception: Unable to find the var name for anonymous code object gml_Script_layerFormat
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_layerConfirm

System.Exception: Unable to find the var name for anonymous code object gml_Script_layerConfirm
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_layerFormat

System.Exception: Unable to find the var name for anonymous code object gml_Script_layerFormat
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_data_compatibility

System.Exception: Unable to find the var name for anonymous code object gml_Script_data_compatibility
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_mod_folder_afom

System.Exception: Unable to find the var name for anonymous code object gml_Script_mod_folder_afom
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_mod_folder_afom

System.Exception: Unable to find the var name for anonymous code object gml_Script_mod_folder_afom
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_find_files_recursive

System.Exception: Unable to find the var name for anonymous code object gml_Script_find_files_recursive
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_SplitString

System.Exception: Unable to find the var name for anonymous code object gml_Script_SplitString
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_json_save

System.Exception: Unable to find the var name for anonymous code object gml_Script_json_save
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_json_save

System.Exception: Unable to find the var name for anonymous code object gml_Script_json_save
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_mod_folder_afom

System.Exception: Unable to find the var name for anonymous code object gml_Script_mod_folder_afom
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_mod_folder_afom

System.Exception: Unable to find the var name for anonymous code object gml_Script_mod_folder_afom
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_tileLayer_isSecret

System.Exception: Unable to find the var name for anonymous code object gml_Script_tileLayer_isSecret
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_layerFormat

System.Exception: Unable to find the var name for anonymous code object gml_Script_layerFormat
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_SplitString

System.Exception: Unable to find the var name for anonymous code object gml_Script_SplitString
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_fix_spawner_variables

System.Exception: Unable to find the var name for anonymous code object gml_Script_fix_spawner_variables
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_general_folder_afom

System.Exception: Unable to find the var name for anonymous code object gml_Script_general_folder_afom
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|5_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModToolCE\UndertaleModToolCE\UndertaleModLib\Decompiler\Decompiler.cs:line 648
*/
scr_playerreset()
gml_Script_modRoom_init()
global.editingLevel = 1
gml_Script_instanceManager_reset()
stopSong()
global.panic = 0
window_set_cursor(cr_default)
draw_set_font(global.editorfont)
var comment = ""
level = global.editorLevelName
lvlRoom = global.editorRoomName
data = roomData_new()
port_mode = 0
levelSettings = level_load(level)
levelNameList = []
var dir = gml_Script_mod_folder_afom("levels/")
levelFiles = gml_Script_find_files_recursive(dir, ".ini")
for (var i = 0; i < array_length(levelFiles); i++)
    array_push(levelNameList, string_replace(string_replace(filename_path(levelFiles[i]), dir, ""), "/", ""))
spriteList = global.sprite_names
audioList = global.audio_names
prevData = data
undo_stack = ds_stack_create()
redo_stack = ds_stack_create()
other_stack = ds_stack_create()
updateUndoMemory = 0
_stSet("data.properties.roomX", 0)
_stSet("data.properties.roomY", 0)
gridSize = 32
camZoom = 1
layer_instances = 0
layer_tilemap = 5
layer_background = 5
roomNameList = []
checkSelector = 0
initialX = 0
initialY = 0
levelList = global.levelNameList
inst = obj_noisecredit
keepgo = 0
savedObjSpr = -4
skipindex = -4
preset = 0
inMenu = 0
variableString = ""
variableValue = ""
variableParamSelected = 0
inVarMenu = 0
trailsprs = 0
placingInst = 0
deletingTile = 0
deletingRooms = 0
roomNameAdd = ""
bgStructDraw = 0
for (var rm = file_find_first((gml_Script_mod_folder_afom("levels/") + level + "/rooms/*.json"), 0); rm != ""; rm = file_find_next())
{
    if (string_count("_wfixed", string(rm)) == 0)
        array_push(roomNameList, filename_name(filename_change_ext(rm, "")))
}
function roomPath() //gml_Script_roomPath
{
    var fName = fstring(gml_Script_mod_folder_afom("levels/{level}/rooms/{lvlRoom}_wfixed.json"))
    if (!file_exists(fName))
        fName = fstring(gml_Script_mod_folder_afom("levels/{level}/rooms/{lvlRoom}.json"))
    return fName;
}

function objDataPath() //gml_Script_objDataPath
{
    var pName = "editor_assets/objects.json"
    return pName;
}

function saveData() //gml_Script_saveData
{
    data.editorVersion = global.editorVersion
    
    // NEW: save ids as string
    for (var i = 0; i < array_length(data.instances); i++)
    {
        inst = data.instances[i]
        objectId = inst.object
        if (typeof(objectId) != "string") {
            objectId = object_get_name(objectId)
            inst.object = objectId
        }
    }
    // NEW: end of NEW

    var jText = json_stringify(data, 1)

    // NEW: reset object id as number
    for (var i = 0; i < array_length(data.instances); i++) {
        inst = data.instances[i]
        objectId = inst.object
        if (typeof(objectId) == "string")
        {
            objectId = asset_get_index(objectId)
            inst.object = objectId
        }
    }
    // NEW: end of NEW

    var b = 1
    var p = "levels/{level}/rooms/"
    var backup = gml_Script_mod_folder_afom(fstring(p + "backups/{lvlRoom}.backup"))
    var oldBackupDir = gml_Script_mod_folder_afom(fstring(p + "backups"))
    var rBackup = "backups/" + backup




    if directory_exists(oldBackupDir)
    {
        var oldB = gml_Script_find_files_recursive((oldBackupDir + "/"), "")
        for (var i = 0; i < array_length(oldB); i++)
        {
            var bNum = gml_Script_SplitString(oldB[i], ".backup")
            file_copy(oldB[i], ("backups/" + oldB[i]))
            file_delete(oldB[i])
        }
    }
    directory_destroy(oldBackupDir)
    for (b = 0; b <= 4; b++)
    {
        if file_exists(rBackup + string(b))
        {
            if (b == 0)
                file_delete(rBackup + "0")
            else
                file_rename((rBackup + string(b)), (rBackup + (string(b - 1))))
        }
    }
    gml_Script_json_save(jText, roomPath())
    gml_Script_json_save(jText, (rBackup + "4"))
    level_save(level, levelSettings)
    obj_modAssets.saveNotice = 120
}

function loadData() //gml_Script_loadData
{
    if file_exists(roomPath())
    {
        var jText = file_text_read_all(roomPath())
        if (jText == "")
        {
            show_message(string(roomPath()) + " has unfortunately corrupted. It has been deleted from your list of rooms in order to maintain stability")
            file_delete(roomPath())
        }
        data = json_parse(jText)
        data = gml_Script_data_compatibility(data)
        for (var i = 0; i < array_length(data.instances); i++)
        {
            // NEW: load object id as number
            inst = data.instances[i]
            objectId = inst.object
            if (typeof(objectId) == "string")
            {
                objectId = asset_get_index(objectId)
                inst.object = objectId
            }
            // NEW: end of NEW

            _temp = i
            if _stGet("data.instances[_temp].deleted")
                ds_stack_push(deletedIndexes, i)
        }
        return 1;
    }
    return 0;
}

function initStage(argument0) //gml_Script_initStage
{
    data = argument0
    instance_activate_object(obj_editorInst)
    with (obj_editorInst)
        instance_destroy()
    with (obj_customBG)
        instance_destroy()
    with (obj_tilemapDrawer)
        instance_destroy()
    for (var i = 0; i < array_length(struct_get(data, "instances")); i++)
    {
        _temp = i
        if (!_stGet("data.instances[_temp].deleted"))
            initInst(i)
    }
    var tileLayers = variable_struct_get_names(_stGet("data.tile_data"))
    for (i = 0; i < array_length(tileLayers); i++)
        initTileLayer(int64(tileLayers[i]))
    var bgLayers = variable_struct_get_names(_stGet("data.backgrounds"))
    for (i = 0; i < array_length(bgLayers); i++)
        editor_initBGLayer(int64(bgLayers[i]), "")
}

function initInst(argument0) //gml_Script_initInst
{
    var insts = struct_get(data, "instances")
    var insData = insts[argument0]
    var l = struct_get(insData, "layer")
    if (l == undefined)
    {
        insData.deleted = 1
        return -4;
    }
    gml_Script_layerConfirm("Instances", l)
    var ins = instance_create_layer(struct_get(struct_get(insData, "variables"), "x"), struct_get(struct_get(insData, "variables"), "y"), layer_get_id(gml_Script_layerFormat("Instances", l)), obj_editorInst)
    
    
    // NEW: more name id...
    objectId = insData.object
    if (typeof(objectId) == "string")
    {
        objectId = asset_get_index(objectId)
        insData.object = objectId
    }
    // NEW: end of NEW
    
    
    var obj = struct_get(insData, "object")
    
    ins.sprite_index = object_get_sprite(obj)
    ins.instID = argument0
    instance_update_variables(ins, insData)
    if placingInst
    {
        ins.placingInst = 1
        placingInst = 0
    }
    return ins;
}

function addInst(argument0, argument1, argument2) //gml_Script_addInst
{
    var newInst = struct_new([["object", argument0], ["deleted", 0], ["variables", struct_new([["x", argument1], ["y", argument2]])], ["layer", layer_instances]])
    var instInd = array_length(struct_get(data, "instances"))
    if (!ds_stack_empty(deletedIndexes))
        instInd = ds_stack_pop(deletedIndexes)
    _temp = instInd
    data.instances[_temp] = newInst
    placingInst = 1
    if (!port_mode)
        return initInst(instInd);
    return struct_new([["instID", instInd]]);
}

function initTileLayer(argument0, argument1) //gml_Script_initTileLayer
{
    gml_Script_layerConfirm("Tiles", argument0)
    var off = [0, 0]
    if (argument1 == 1)
        off = [_stGet("data.properties.roomX"), _stGet("data.properties.roomY")]
    with (obj_tilemapDrawer)
    {
        if (layer_get_name(layer) == gml_Script_layerFormat("Tiles", argument0))
        {
            initTilemapDrawer(other.data, argument0)
            return;
        }
    }
    var tmd = instance_create_layer(0, 0, layer_get_id(gml_Script_layerFormat("Tiles", argument0)), obj_tilemapDrawer)
    with (tmd)
        initTilemapDrawer(other.data, argument0)
}

pleaseExist = ""
function addTile(argument0, argument1, argument2, argument3, argument4, argument5, argument6) //gml_Script_addTile
{
    var name = argument0
    var coord = argument1
    var xx = int64(argument2)
    var yy = int64(argument3)
    if (argument4 == undefined)
        argument4 = 0
    if (argument5 == undefined)
        argument5 = 1
    if (argument6 == undefined)
        argument6 = 1
    var flipX = argument5
    var flipY = argument6
    tileLayerConfirm(layer_tilemap)
    var tLayer = string(layer_tilemap)
    _stSet(("data.tile_data." + tLayer + "." + string(xx) + "_" + string(yy)), struct_new([["tileset", name], ["coord", coord], ["flipX", flipX], ["flipY", flipY], ["autotile", argument4], ["autotile_index", tileset_autotileIndex]]))
    if port_mode
        return;
    var itExists = 0
    var camScale = camera_get_view_width(view_camera[0])
    with (obj_tilemapDrawer)
    {
        if (layer_tilemap == other.layer_tilemap)
        {
            drawTileToSurface(name, coord, xx, yy, flipX, flipY)
            itExists = 1
        }
    }
    if (!itExists)
        initTileLayer(layer_tilemap)
}

function deleteTile(argument0, argument1) //gml_Script_deleteTile
{
    deletingTile = 1
    var xx = int64(argument0)
    var yy = int64(argument1)
    var camScale = camera_get_view_width(view_camera[0])
    var tLayer = string(layer_tilemap)
    addTile(tilesetSelected, [0, 0], xx, yy, 0)
    variable_struct_remove(_stGet("data.tile_data." + tLayer), (string(xx) + "_" + string(yy)))
    with (obj_tilemapDrawer)
    {
        if (layer_tilemap == other.layer_tilemap)
            eraseTileFromSurface(xx, yy)
    }
}

deletedIndexes = ds_stack_create()
cursorMode = 0
lockCursorMode = 0
cursorImage = 0
cursorStretch = [0, 0]
prevGridPos = [0, 0]
updateStretch = 1
cursorNotice = ""
editor_state = -1
tilesetFolder = 0
tilesetSelected = "tile_entrance1"
tilesetCoord = [0, 0, 1, 1]
tilesetCoord_editing = tilesetCoord
tilesetCoord_spread = [tilesetCoord]
tileset_doAutoTile = 0
tileset_autotileIndex = 0
tileset_listScroll = 0
tile_selection = [0, 0, 0, 0, 0, 0]
tile_selection_made = 0
tile_selection_keys = []
tile_selection_moving = 0
tile_selection_move_origin = [0, 0, 0, 0]
roomHovering = -1
bgsHovering = -1
prevBGPreset = ""
settingsMode = 0
settingsHovering = -1
toolbarHovering = -1
debugHovering = -1
instSelected = -4
instOn = -4
selCarry = []
objIndex = 574
global.currentRoom = lvlRoom
var exists = loadData()
var prop = data.properties
if ((prop.levelWidth - prop.roomX) > 16384)
{
    prop.levelWidth = floor(512) * 32 + prop.roomX
    prop.levelHeight = floor(512) * 32 + prop.roomY
}
initStage(data)
if (!exists)
{
    saveData()
    var rn = lvlRoom
    array_push(roomNameList, rn)
}
cam_x = 0
cam_y = 0
scroll_x = mouse_x
scroll_y = mouse_y
camScroll = [0, 0]
roomResize = [0, 0]
roomPreResize = [0, 0, 100, 100]
objFile = global.objectData
objFolders = objFile.folders
objFolderSelected = 0
objFolderOrder = objFile.order
for (i = 0; i < array_length(objFolderOrder); i++)
{
    var oF = _stGet("objFolders." + objFolderOrder[i])
    for (var j = 0; j < array_length(oF); j++)
    {
        var o = oF[j]
        if is_string(o)
        {
            _temp = j
            _stSet(("objFolders." + objFolderOrder[i] + "[_temp]"), asset_get_index(o))
        }
    }
}
objSelected = 574
objFlipX = 0
objFlipY = 0
tileFlipX = 1
tileFlipY = 1
windows_init()
w_scale = 2
_stSet("w_canvas.toolbar", _wCanvas(548, 48, "toolbar"))
_stSet("w_canvas.objFolders", _wCanvas(86, 324, "objFolders"))
_stSet("w_canvas.objFolders.gridSize", [86, 24])
_stSet("w_canvas.objGrid", _wCanvas(256, 200, "objGrid"))
_stSet("w_canvas.objGrid.gridSize", 36)
_stSet("w_canvas.objGrid.columns", 7)
struct_set(w_canvas.objGrid, [["surfaceScale", 0.5]])
_stSet("w_canvas.layerDisplay", _wCanvas(250, 48, "layerDisplay"))
_stSet("w_canvas.tilesetList", _wCanvas(100, 296, "tilesetList"))
_stSet("w_canvas.tileset", _wCanvas(256, 256, "tileset"))
windows_add_canvas((110 * array_length(global.tilesetData.order)), 14, "tilesetFolders")
windows_add_canvas(100, 32, "tilesetMode")
windows_add_canvas(32, 48, "autotileInd")
windows_add_canvas(48, 16, "autotileEditButton")
windows_add_canvas(320, 160, "autotileEditor")
var r = _wCanvas(150, 256, "rooms")
_stSet("w_canvas.rooms", r)
_stSet("w_canvas.bgs", _wCanvas(280, 210, "bgs"))
windows_add_canvas(200, 200, "bgPresetDropdown")
_stSet("w_canvas.settingTypes", _wCanvas(64, 32, "settingTypes"))
_stSet("w_canvas.settings", _wCanvas(300, 208, "settings"))
_stSet("w_canvas.instanceMenu", _wCanvas(256, 128, "instanceMenu"))
_stSet("w_canvas.debug", _wCanvas(300, 160, "debug"))
_stSet("w_canvas.editorSettings", _wCanvas(250, 144, "editorSettings"))
windows_add_canvas(100, 150, "valueDropdown")
wCanvas_open("toolbar", 10, 10)
wCanvas_open("layerDisplay", 10, 460)
var noisewidth = 720
var noiseheight = 405
noiseX = (960 - noisewidth) / 2
noiseY = (540 - noiseheight) / 2
_stSet("w_canvas.noiseheads", _wCanvas(noisewidth, noiseheight, "noiseheads"))
cscale = noisewidth / 960
nselect = undefined
currnoisehead = 0
windows_add_canvas(200, 200, "bigDropdown")
windows_add_canvas(400, 300, "createVariable")
windows_add_canvas(400, 300, "editVariable")
st_instances = 0
st_tiles = 1
st_backgrounds = 2
st_rooms = 3
st_settings = 4
st_save = 5
st_play = 6
st_edit = 7
st_debug = 8
st_editorsettings = 9
st_start = 10
st_resize = 11
st_popup = 12
windowQuickDraw = 0
windowQuickErase = 0
fromStart = 0
function editorWindowUpdate(argument0) //gml_Script_editorWindowUpdate
{
    if windowQuickErase
    {
        for (var i = 0; i < array_length(w_openCanvas); i++)
            w_openCanvas[i].quickerase = 1
        windowQuickErase = 0
    }
    inVarMenu = 0
    wCanvas_close("objFolders")
    wCanvas_close("objGrid")
    wCanvas_close("tilesetList")
    wCanvas_close("tileset")
    wCanvas_close("rooms")
    wCanvas_close("bgs")
    wCanvas_close("settingTypes")
    wCanvas_close("settings")
    wCanvas_close("debug")
    wCanvas_close("editorSettings")
    wCanvas_close("instanceMenu")
    wCanvas_close("tilesetMode")
    wCanvas_close("tilesetFolders")
    wCanvas_close("autotileInd")
    wCanvas_close("autotileEditor")
    wCanvas_close("autotileEditButton")
    wCanvas_close("bgPresetDropdown")
    wCanvas_close("bgEscapeData")
    wCanvas_close("bigDropdown")
    wCanvas_close("noiseheads")
    wCanvas_close("createVariable")
    wCanvas_close("editVariable")
    if (argument0 == 1)
    {
    }
    switch editor_state
    {
        case st_instances:
            wCanvas_open("objFolders", 10, 68)
            wCanvas_open("objGrid", 96, 68)
            break
        case st_tiles:
            var sep = 8
            var tf = wCanvas_open("tilesetFolders", 10, (74 - sep))
            var tl = wCanvas_open("tilesetList", 10, (tf.y + tf.height + sep))
            struct_set(tl, [["sep", 24]])
            var fs = global.tilesetData.folders
            var sets = struct_get(fs, global.tilesetData.order[tilesetFolder])
            struct_set(tl, [["scrollBorders", [0, max((array_length(sets) * tl.sep - tl.height), 0)]]])
            struct_set(tl, [["scroll_y", tileset_listScroll]])
            var t = wCanvas_open("tileset", 110, (tf.y + tf.height + sep))
            struct_set(t, [["zoom", 1]])
            var ts = _tileset(tilesetSelected)
            if (array_length(ts.autotile) > 0)
            {
                var tOpt = ["Tileset", "Auto Tile"]
                var dd = wCanvas_open_dropdown("tilesetMode", t.x, (t.y + t.height), tOpt, tOpt[tileset_doAutoTile], "tilesetModeChanged")
                struct_set(dd, [["canExit", 0]])
            }
            if tileset_doAutoTile
            {
                var opts = []
                for (i = 0; i < array_length(ts.autotile); i++)
                    opts[i] = i
                if (array_length(opts) > 1)
                {
                    var nd = wCanvas_open_dropdown("autotileInd", (dd.x + dd.width), dd.y, opts, tileset_autotileIndex, "autotileIndexChanged")
                    struct_set(nd, [["canExit", 0]])
                    if (!(gml_Script_array_value_exists(global.defaultTilesets, tilesetSelected)))
                        wCanvas_open("autotileEditButton", (nd.x + nd.width), nd.y)
                }
            }
            break
        case st_backgrounds:
            wCanvas_open("bgs", 10, 68)
            break
        case st_rooms:
            wCanvas_open("rooms", 10, 68)
            break
        case st_settings:
            wCanvas_open("settingTypes", 10, 68)
            wCanvas_open("settings", 74, 68)
            break
        case st_debug:
            wCanvas_open("debug", 10, 68)
            break
        case st_editorsettings:
            wCanvas_open("editorSettings", 10, 68)
            break
        default:
            windowQuickDraw = 1
    }

    if windowQuickDraw
    {
        for (i = 0; i < array_length(w_openCanvas); i++)
            w_openCanvas[i].quickdraw = 1
        windowQuickDraw = 0
    }
}

if (!(variable_struct_exists(global.editorMemory, lvlRoom)))
    struct_set(global.editorMemory, [[lvlRoom, new_memoryVarStruct()]])
__mem = global.editorMemory
varStruct = _stGet("__mem." + lvlRoom)
var varsToSet = variable_struct_get_names(varStruct)
for (i = 0; i < array_length(varsToSet); i++)
    variable_instance_set(id, varsToSet[i], _stGet("varStruct." + varsToSet[i]))
tilesetFolder = clamp(tilesetFolder, 0, (array_length(global.tilesetData.order) - 1))
editorWindowUpdate()
doubleClickTimer = 0
selectingMode = 0
